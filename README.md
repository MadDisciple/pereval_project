# Проект "ФСТР. Перевал" (REST API)

Этот проект предоставляет REST API для мобильного приложения Федерации Спортивного Туризма России. 
API позволяет туристам отправлять информацию о горных перевалах, которую затем модерируют сотрудники ФСТР.

## Реализованный функционал

### Спринт 1:
* **Улучшенная структура БД:** Проект использует SQLAlchemy и PostgreSQL. Вместо хранения данных в "сыром" JSON, структура базы данных нормализована. Созданы отдельные связанные таблицы для:
    * `users` (данные пользователя)
    * `coords` (координаты)
    * `pereval_added` (основная информация о перевале, включая статус модерации)
    * `images` (данные о фотографиях)
    * `pereval_images` (связующая таблица "многие-ко-многим")
* **Метод `POST /submitData`**: Основной метод для добавления новых перевалов.
    * Данные проходят валидацию через Pydantic-схемы.
    * При добавлении записи автоматически выставляется `status: "new"`.
    * Если юзер с таким `email` уже есть, его данные (ФИО, телефон) обновляются. Если нет — создается новый юзер.
    * Все добавление происходит в рамках одной транзакции (либо всё, либо ничего).
* **Переменные окружения**: Все настройки БД (`HOST`, `PORT`, `LOGIN`, `PASS`, `NAME`) читаются из `.env` файла и не хранятся в коде.

### Спринт 2:
* **`GET /submitData/{id}`**: Получение полной информации об одной записи по её `id`.
* **`GET /submitData/?user__email=<email>`**: Получение списка всех перевалов, отправленных пользователем с указанным `email`.
* **`PATCH /submitData/{id}`**: Редактирование перевала.
    * Редактирование **запрещено**, если `status` не равен `"new"`.
    * Редактирование полей пользователя (ФИО, email, телефон) запрещено.

---

## Локальный запуск и API

### 1. Настройка окружения

1.  Убедитесь, что у вас запущен **PostgreSQL**.
2.  Создайте базу данных (например, `pereval`).
3.  Склонируйте репозиторий:
    ```bash
    git clone [URL_ВАШЕГО_РЕПОЗИТОРИЯ]
    cd [ПАПКА_РЕПОЗИТОРИЯ]
    ```
4.  Создайте и активируйте виртуальное окружение:
    ```bash
    python -m venv venv
    source venv/bin/activate (Linux)
    venv\Scripts\activate (Windows)
    ```
5.  Установите зависимости:
    ```bash
    pip install -r requirements.txt
    ```
6.  Создайте файл `.env` (скопируйте `.env.example`) и впишите ваши данные от PostgreSQL:
    ```ini
    FSTR_DB_HOST=localhost
    FSTR_DB_PORT=5432
    FSTR_DB_LOGIN=postgres
    FSTR_DB_PASS=ваш_пароль
    FSTR_DB_NAME=pereval
    ```

### 2. Запуск API

1.  Запустите сервер Uvicorn:
    ```bash
    uvicorn main:app --reload
    ```
2.  Сервер будет доступен по адресу: `http://127.0.0.1:8000`

---

##  Документация API (Swagger)

Этот проект использует FastAPI, который автоматически генерирует интерактивную документацию Swagger (OpenAPI).

После запуска сервера, откройте в браузере:
**`http://127.0.0.1:8000/docs`**

Вы увидите полный список всех методов API (`POST`, `GET`, `PATCH`), их параметры, тела запросов и ожидаемые ответы. Вы можете тестировать API прямо из этого интерфейса.